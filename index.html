<!DOCTYPE html>
<html>
  <head>
    <title>Program 5</title>
      <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script>
  </head>
  <body>
    <h1>Select a Major</h1>
    <input type="button" id="citbtn" value="CIT Majors">
    <input type="button" id="busbtn" value="Business Majors">
    <h2>We filter out dataset by major</h2>

    <div id="result"></div>
    <script type="text/x-handlebars-template" id="tableTemplate">
      <table cellspacing='12'>
        <tr><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>
        {{#each rows}}
          <tr>
            <td>{{name}}</td><td>{{major}}</td><td>{{midterm}}</td><td>{{final}}</td>
          </tr>
        {{/each}}
      </table>
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var btns = document.querySelectorAll('#citbtn, #busbtn')
        console.log(btns)
        btns.forEach(function(btn) {
          btn.onclick = async function() {
            var response = await fetch('cit5students.json');
            if(response.ok) {
              var data = await response.json()
              var majorFilter = ""
              if (btn.id == "citbtn") {
                majorFilter = "CIT"
              }
              if (btn.id == "busbtn") {
                majorFilter = "BUS"
              }
              data = data.filter( (student) => student.major == majorFilter);

              var templateText = document.getElementById('tableTemplate').innerHTML;
              var compiledTemplateText = Handlebars.compile(templateText);
              compiledHTML = compiledTemplateText({ rows: data })
              document.querySelector('#result').innerHTML = compiledHTML;
            }
            else {
              document.querySelector('#result').innerHTML = "Data not found";
            }
          }});
      })
    </script>

  </body>

</html>

